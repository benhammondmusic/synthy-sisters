<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="icon" type="image/png" href="icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Monoton&family=Rock+Salt&display=swap" rel="stylesheet">
  <title>SynthySisters</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #a78bfa 0%, #f9a8d4 50%, #93c5fd 100%);
      font-family: system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
      overflow-y: auto;
    }

    #user-select-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 11;
      background: linear-gradient(135deg, #a78bfa 0%, #f9a8d4 50%, #93c5fd 100%);
      gap: 30px;
    }

    .user-button {
      padding: 25px 50px;
      font-size: 32px;
      background: white;
      border: none;
      border-radius: 16px;
      box-shadow:
        0 0 10px hotpink,
        0 0 20px hotpink,
        0 0 40px hotpink,
        0 10px 25px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      font-weight: bold;
      font-family: "Rock Salt", cursive;
      text-transform: uppercase;
      letter-spacing: 2px;
      touch-action: manipulation;
      transition: all 0.3s ease;
    }

    .user-button.nora {
      color: #ff1493;
    }

    .user-button.emma {
      color: #9370db;
    }

    .user-button:active {
      transform: scale(0.95);
      box-shadow:
        0 0 5px hotpink,
        0 0 10px hotpink,
        0 5px 10px rgba(0, 0, 0, 0.4);
    }

    #start-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 10;
      background: linear-gradient(135deg, #a78bfa 0%, #f9a8d4 50%, #93c5fd 100%);
    }

    #start-button {
      padding: 30px 60px;
      font-size: 28px;
      background: white;
      border: none;
      border-radius: 16px;
      box-shadow:
        0 0 10px hotpink,
        0 0 20px hotpink,
        0 0 40px hotpink,
        0 0 80px hotpink,
        0 10px 25px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      font-weight: 400;
      color: #59008c;
      font-family: "Monoton", sans-serif;
      font-style: normal;
      text-transform: uppercase;
      letter-spacing: 2px;
      touch-action: manipulation;
      transition: all 0.3s ease;
    }

    #start-button:active {
      transform: scale(0.98);
      box-shadow:
        0 0 5px hotpink,
        0 0 10px hotpink,
        0 0 20px hotpink,
        0 5px 10px rgba(0, 0, 0, 0.4);
    }

    #user-name {
      font-size: clamp(40px, 8vw, 80px);
      text-align: center;
      margin: 20px 0;
      font-family: "Rock Salt", cursive;
      font-weight: 700;
      display: none;
      letter-spacing: 8px;
    }

    #user-name.show {
      display: block;
    }

    #user-name span {
      display: inline-block;
      text-shadow:
        3px 3px 0px rgba(0, 0, 0, 0.1),
        0 0 20px currentColor;
      animation: float 2s ease-in-out infinite;
      margin: 0 2px;
    }

    #user-name span:nth-child(1) {
      color: #ff6b9d;
      animation-delay: 0s;
    }

    #user-name span:nth-child(2) {
      color: #ffa07a;
      animation-delay: 0.1s;
    }

    #user-name span:nth-child(3) {
      color: #ffd700;
      animation-delay: 0.2s;
    }

    #user-name span:nth-child(4) {
      color: #98fb98;
      animation-delay: 0.3s;
    }

    #user-name span:nth-child(5) {
      color: #87ceeb;
      animation-delay: 0.4s;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0px) scale(1);
      }

      50% {
        transform: translateY(-20px) scale(1.1);
      }
    }

    #user-name.bounce span {
      animation: bounce 0.6s ease;
    }

    #piano {
      position: relative;
      display: none;
      width: 95%;
      max-width: 1000px;
      margin: 0 auto;
    }

    .white-key {
      width: 5.5555%;
      height: 192px;
      background: rgb(248, 212, 255);
      border: 2px solid #1f2937;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      position: relative;
      z-index: 1;
      transition: all 0.1s ease;
      touch-action: manipulation;
    }

    .black-key {
      width: 3.7037%;
      height: 128px;
      background: #59008c;
      border: 2px solid #030712;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      position: absolute;
      z-index: 2;
      pointer-events: auto;
      transition: all 0.1s ease;
      touch-action: manipulation;
    }

    @media screen and (max-width: 700px) {
      #piano {
        width: 100%;
      }

      .white-key {
        width: 6.6666%;
        height: 160px;
      }

      .black-key {
        width: 4.4444%;
        height: 106px;
      }

      .white-key span {
        font-size: 8px;
        bottom: 10px;
      }
    }

    #white-keys {
      display: flex;
      gap: 0;
    }

    .white-key:active,
    .white-key.pressed {
      background: hotpink;
      transform: translateY(2px);
      box-shadow: 0 5px 10px -3px rgba(0, 0, 0, 0.2);
    }

    .white-key span {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      color: #4b5563;
      font-weight: 400;
      font-size: 10px;
      pointer-events: none;
      user-select: none;
      white-space: nowrap;
    }

    #black-keys {
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      gap: 0;
      pointer-events: none;
      width: 100%;
    }

    .black-key:active,
    .black-key.pressed {
      background: hotpink;
      transform: translateY(2px);
      box-shadow: 0 10px 15px -5px rgba(0, 0, 0, 0.2);
    }

    #notice {
      font-size: clamp(14px, 2vw, 12px);
      color: white;
      text-align: center;
      font-weight: bold;
      margin: 20px 0;
      font-style: italic;
      position: fixed;
      bottom: 10px;
      left: 0;
      right: 0;
    }

    #reset-button {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.5);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      opacity: 0.6;
      transition: all 0.3s ease;
      z-index: 100;
      touch-action: manipulation;
    }

    #reset-button:hover {
      opacity: 1;
      background: rgba(255, 255, 255, 0.5);
    }

    #reset-button:active {
      transform: scale(0.9);
    }

    #help-button {
      position: fixed;
      top: 10px;
      right: 60px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.5);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      opacity: 0.6;
      transition: all 0.3s ease;
      z-index: 100;
      touch-action: manipulation;
    }

    #help-button:hover {
      opacity: 1;
      background: rgba(255, 255, 255, 0.5);
    }

    #help-button:active {
      transform: scale(0.9);
    }

    #help-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
      z-index: 200;
      max-width: 90%;
      width: 400px;
      display: none;
      text-align: center;
    }

    #help-popup.show {
      display: block;
    }

    #help-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 199;
      display: none;
    }

    #help-overlay.show {
      display: block;
    }

    #help-popup h3 {
      font-family: "Rock Salt", cursive;
      color: #59008c;
      margin-bottom: 20px;
      font-size: 20px;
    }

    #help-popup p {
      color: #333;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    #help-popup button {
      padding: 12px 30px;
      font-size: 16px;
      background: linear-gradient(135deg, #a78bfa 0%, #f9a8d4 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      touch-action: manipulation;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #help-popup button:active {
      transform: scale(0.95);
    }

    #app-title {
      position: fixed;
      top: 10px;
      left: 10px;
      font-family: "Rock Salt", cursive;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      z-index: 100;
      text-shadow: 0 0 5px rgba(255, 105, 180, 0.3);
    }
  </style>
</head>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function (registration) {
      console.log('Service Worker registered');
      setInterval(function () {
        registration.update();
      }, 30000);
    }).catch(function (error) {
      console.log('Service Worker registration failed:', error);
    });
  }
</script>

<body>
  <div id="app-title">SynthySisters</div>
  <button id="help-button" title="Help"></button>
  <button id="reset-button" title="Switch User">ðŸ¦„</button>

  <div id="help-overlay"></div>
  <div id="help-popup">
    <h3>ðŸ”” Sound Not Working?</h3>
    <p>If you're using an iOS device (iPhone/iPad), make sure your device is <strong>not in Silent Mode</strong>!</p>
    <p>Check the physical switch on the side of your device.</p>
    <button id="close-help">Got it! âœ¨</button>
  </div>

  <div id="user-select-screen">
    <h2
      style="color: white; font-family: 'Rock Salt', cursive; font-size: clamp(24px, 5vw, 36px); margin-bottom: 20px;">
      Who's Playing? ðŸŽ¹</h2>
    <button class="user-button nora" data-user="nora">Nora ðŸ¦„</button>
    <button class="user-button emma" data-user="emma">Emma ðŸŒŸ</button>
  </div>

  <div id="user-name"></div>

  <div id="piano">
    <div id="white-keys"></div>
    <div id="black-keys"></div>
  </div>

  <script>
    let audioContext = null;
    let currentUser = null;

    const keys = [
      { note: 'C3', freq: 261.63 },
      { note: 'C#3', freq: 277.18 },
      { note: 'D3', freq: 293.66 },
      { note: 'D#3', freq: 311.13 },
      { note: 'E3', freq: 329.63 },
      { note: 'F3', freq: 349.23 },
      { note: 'F#3', freq: 369.99 },
      { note: 'G3', freq: 392.00 },
      { note: 'G#3', freq: 415.30 },
      { note: 'A3', freq: 440.00 },
      { note: 'A#3', freq: 466.16 },
      { note: 'B3', freq: 493.88 },
      { note: 'C4', freq: 523.25 },
      { note: 'C#4', freq: 554.37 },
      { note: 'D4', freq: 587.33 },
      { note: 'D#4', freq: 622.25 },
      { note: 'E4', freq: 659.25 },
      { note: 'F4', freq: 698.46 },
      { note: 'F#4', freq: 739.99 },
      { note: 'G4', freq: 783.99 },
      { note: 'G#4', freq: 830.61 },
      { note: 'A4', freq: 880.00 },
      { note: 'A#4', freq: 932.33 },
      { note: 'B4', freq: 987.77 },
      { note: 'C5', freq: 1046.50 },
      { note: 'C#5', freq: 1108.73 },
      { note: 'D5', freq: 1174.66 },
      { note: 'D#5', freq: 1244.51 },
      { note: 'E5', freq: 1318.51 },
      { note: 'F5', freq: 1396.91 },
      { note: 'F#5', freq: 1479.98 },
      { note: 'G5', freq: 1567.98 },
      { note: 'G#5', freq: 1661.22 },
      { note: 'A5', freq: 1760.00 },
      { note: 'A#5', freq: 1864.66 },
      { note: 'B5', freq: 1975.53 },
      { note: 'C6', freq: 2093.00 },
    ];

    // User selection
    document.querySelectorAll('.user-button').forEach(button => {
      button.addEventListener('click', function () {
        currentUser = this.dataset.user;

        // Initialize audio context
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          if (audioContext.state === 'suspended') {
            audioContext.resume();
          }
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          gain.gain.value = 0;
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.start();
          osc.stop(audioContext.currentTime + 0.001);
        }

        // Build piano
        initPiano();

        document.getElementById('user-select-screen').style.display = 'none';
        document.getElementById('piano').style.display = 'block';

        const userName = document.getElementById('user-name');
        const name = currentUser.toUpperCase();
        userName.innerHTML = '';

        for (let i = 0; i < name.length; i++) {
          const span = document.createElement('span');
          span.textContent = name[i];
          userName.appendChild(span);
        }

        userName.classList.add('show');
      });
    });

    function playNote(frequency, button) {
      if (!audioContext) {
        return;
      }

      const userName = document.getElementById('user-name');
      if (userName.classList.contains('show')) {
        userName.classList.remove('bounce');
        void userName.offsetWidth;
        userName.classList.add('bounce');
      }

      try {
        button.classList.add('pressed');
        setTimeout(() => button.classList.remove('pressed'), 200);

        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';

        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.8);
      } catch (error) {
        console.error('Error playing note:', error);
      }
    }

    function initPiano() {
      const whiteKeysContainer = document.getElementById('white-keys');
      const blackKeysContainer = document.getElementById('black-keys');

      whiteKeysContainer.innerHTML = '';
      blackKeysContainer.innerHTML = '';

      let whiteKeyPosition = 0;

      const isNarrowScreen = window.innerWidth <= window.innerHeight;
      let keysToDisplay = keys;

      if (isNarrowScreen) {
        keysToDisplay = keys.slice(0, 25);
      }

      const TOTAL_WHITE_KEYS = keysToDisplay.filter((key) => !key.note.includes('#')).length;
      const WHITE_KEY_WIDTH_PERCENT = 100 / TOTAL_WHITE_KEYS;
      const BLACK_KEY_WIDTH_PERCENT = (WHITE_KEY_WIDTH_PERCENT * 2) / 3;

      keysToDisplay.forEach((key) => {
        const isSharp = key.note.includes('#');

        if (!isSharp) {
          const button = document.createElement('button');
          button.className = 'white-key';
          button.dataset.freq = key.freq;

          button.addEventListener('touchstart', function (e) {
            e.preventDefault();
            playNote(key.freq, button);
          }, { passive: false });

          button.addEventListener('click', function () {
            playNote(key.freq, button);
          });

          const span = document.createElement('span');
          span.textContent = key.note.charAt(0);
          button.appendChild(span);

          whiteKeysContainer.appendChild(button);
          whiteKeyPosition++;
        } else {
          const button = document.createElement('button');
          button.className = 'black-key';
          button.dataset.freq = key.freq;

          const leftPositionPercent = (whiteKeyPosition * WHITE_KEY_WIDTH_PERCENT) - (BLACK_KEY_WIDTH_PERCENT / 2);
          button.style.left = `${leftPositionPercent}%`;

          button.addEventListener('touchstart', function (e) {
            e.preventDefault();
            playNote(key.freq, button);
          }, { passive: false });

          button.addEventListener('click', function () {
            playNote(key.freq, button);
          });

          blackKeysContainer.appendChild(button);
        }
      });
    }

    let resizeTimer;
    window.addEventListener('resize', function () {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(function () {
        if (document.getElementById('piano').style.display === 'block') {
          initPiano();
        }
      }, 200);
    });

    document.getElementById('reset-button').addEventListener('click', function () {
      if (audioContext) {
        audioContext.close();
        audioContext = null;
      }

      document.getElementById('piano').style.display = 'none';
      document.getElementById('user-name').classList.remove('show');
      document.getElementById('user-select-screen').style.display = 'flex';

      document.getElementById('white-keys').innerHTML = '';
      document.getElementById('black-keys').innerHTML = '';

      currentUser = null;
    });

    let lastPlayedKey = null;

    document.addEventListener('touchmove', function (e) {
      e.preventDefault();

      const touch = e.touches[0];
      const element = document.elementFromPoint(touch.clientX, touch.clientY);

      if (element && (element.classList.contains('white-key') || element.classList.contains('black-key'))) {
        const freq = parseFloat(element.dataset.freq);

        if (freq && element !== lastPlayedKey) {
          playNote(freq, element);
          lastPlayedKey = element;
        }
      }
    }, { passive: false });

    document.addEventListener('touchend', function () {
      lastPlayedKey = null;
    });

    // Help popup
    document.getElementById('help-button').addEventListener('click', function () {
      document.getElementById('help-overlay').classList.add('show');
      document.getElementById('help-popup').classList.add('show');
    });

    document.getElementById('close-help').addEventListener('click', function () {
      document.getElementById('help-overlay').classList.remove('show');
      document.getElementById('help-popup').classList.remove('show');
    });

    document.getElementById('help-overlay').addEventListener('click', function () {
      document.getElementById('help-overlay').classList.remove('show');
      document.getElementById('help-popup').classList.remove('show');
    });
  </script>
</body>

</html>